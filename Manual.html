<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Manual WhatsApp Voice Agent V2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .step-card {
            background: #f8f9fa;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 5px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .step-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            margin-right: 15px;
            font-size: 1.2em;
        }

        .step-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            background: #2980b9;
        }

        .qr-section {
            background: #e8f5e8;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
            border: 2px dashed #4CAF50;
        }

        .qr-code {
            margin: 20px auto;
            padding: 15px;
            background: white;
            border-radius: 10px;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .network-info {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
            margin: 20px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-green { background: #28a745; }
        .status-yellow { background: #ffc107; }
        .status-red { background: #dc3545; }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .troubleshoot {
            background: #f8d7da;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #dc3545;
            margin: 20px 0;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            margin: 10px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }

        .ip-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin: 10px;
            width: 200px;
        }

        .ip-detect-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }

        .footer {
            text-align: center;
            padding: 30px;
            background: #2c3e50;
            color: white;
            border-radius: 15px;
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ü§ñ Manual WhatsApp Voice Agent V2</h1>
            <p>Guia Completo para Iniciar e Usar o Agente de Voz</p>
            <div>
                <span class="status-indicator status-green"></span> FastAPI Backend
                <span class="status-indicator status-green"></span> Whisper STT
                <span class="status-indicator status-yellow"></span> WhatsApp Ready
            </div>
        </div>

        <!-- Quick Start Guide -->
        <div class="step-card">
            <div class="step-title">
                <span class="step-number">üöÄ</span>
                <span>In√≠cio R√°pido (5 Minutos) - M√âTODO RECOMENDADO</span>
            </div>
            <p><strong>Use o script automatizado com ambiente virtual:</strong></p>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
start_venv.bat
            </div>
            <p><strong>Ou manualmente com ambiente virtual:</strong></p>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
cd backend
python main_simple.py
            </div>
            <p>Depois acesse: <a href="http://localhost:8001" target="_blank">http://localhost:8001</a></p>
        </div>

        <!-- Step-by-Step Guide -->
        <div class="step-card">
            <div class="step-title">
                <span class="step-number">1</span>
                <span>Configurar Ambiente Virtual (Recomendado)</span>
            </div>
            <p>O ambiente virtual garante que as depend√™ncias funcionem corretamente:</p>
            
            <h4>M√©todo 1: Script Automatizado</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
start_venv.bat
            </div>
            
            <h4>M√©todo 2: Manual</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
            </div>
            
            <div class="network-info">
                <h4>‚ö° Por que usar ambiente virtual?</h4>
                <ul>
                    <li>üîí <strong>Isola depend√™ncias:</strong> Evita conflitos com outros projetos</li>
                    <li>üêõ <strong>Corrige erros de STT:</strong> Garante vers√µes corretas do librosa/soundfile</li>
                    <li>üõ†Ô∏è <strong>Facilita manuten√ß√£o:</strong> Ambiente limpo e controlado</li>
                </ul>
            </div>
        </div>

        <div class="step-card">
            <div class="step-title">
                <span class="step-number">2</span>
                <span>Verificar Depend√™ncias</span>
            </div>
            <p>Primeiro, verifique se o Python est√° instalado:</p>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
python --version
            </div>
            <p>Vers√£o m√≠nima: <strong>Python 3.8+</strong></p>
            
            <h4>Instalar Depend√™ncias:</h4>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
pip install fastapi uvicorn whisper openai-whisper
            </div>
        </div>

        <div class="step-card">
            <div class="step-title">
                <span class="step-number">3</span>
                <span>Navegar para o Diret√≥rio</span>
            </div>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
cd F:\Projetos2025BKP\Whisper_Whats_Agent_V2
            </div>
        </div>

        <div class="step-card">
            <div class="step-title">
                <span class="step-number">4</span>
                <span>Iniciar o Servidor</span>
            </div>
            <p>Navegue para a pasta backend e inicie o servidor <strong>com ambiente virtual ativado</strong>:</p>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
venv\Scripts\activate
cd backend
python main_simple.py
            </div>
            
            <div class="network-info">
                <h4>‚ö° Aguarde o Carregamento:</h4>
                <ul>
                    <li>üîÑ <strong>Loading Whisper model...</strong> (primeira vez pode demorar)</li>
                    <li>‚úÖ <strong>Whisper model loaded successfully</strong></li>
                    <li>üåê <strong>Server running on http://0.0.0.0:8001</strong></li>
                </ul>
            </div>
        </div>

        <div class="step-card">
            <div class="step-title">
                <span class="step-number">5</span>
                <span>Verificar Status do Sistema</span>
            </div>
            <p>Teste se tudo est√° funcionando:</p>
            <div class="code-block">
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
curl http://localhost:8001/health
            </div>
            
            <p><strong>Resposta esperada:</strong></p>
            <div class="code-block">
{"status":"healthy","whisper_loaded":true,"version":"2.0.1-fixed"}
            </div>
        </div>

        <!-- Network Configuration -->
        <div class="qr-section">
            <h2>üì± Configura√ß√£o para Celular</h2>
            <p>Para acessar pelo celular, conecte-se na <strong>mesma rede WiFi</strong></p>
            
            <div style="margin: 20px 0;">
                <label>Digite o IP do seu computador:</label><br>
                <input type="text" id="ipInput" class="ip-input" placeholder="ex: 192.168.1.100" value="192.168.1.100">
                <button class="ip-detect-btn" onclick="detectIP()">üîç Detectar IP</button>
                <button class="ip-detect-btn" onclick="generateQR()">üì± Gerar QR Code</button>
            </div>

            <div id="currentIP" style="margin: 15px 0; font-weight: bold;"></div>
            
            <div id="qrcode" class="qr-code" style="display: none;"></div>
            
            <div id="mobileLinks" style="display: none;">
                <h3>üîó Links para Celular:</h3>
                <div style="margin: 10px 0;">
                    <strong>Interface Principal:</strong><br>
                    <span id="mainLink" style="color: #2980b9; font-family: monospace;"></span>
                </div>
                <div style="margin: 10px 0;">
                    <strong>Health Check:</strong><br>
                    <span id="healthLink" style="color: #2980b9; font-family: monospace;"></span>
                </div>
            </div>
        </div>

        <!-- Features Overview -->
        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-icon">üé§</div>
                <h3>Speech-to-Text</h3>
                <p>Whisper OpenAI para transcri√ß√£o em portugu√™s</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üí¨</div>
                <h3>Chat em Tempo Real</h3>
                <p>WebSocket para comunica√ß√£o instant√¢nea</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üì±</div>
                <h3>Interface Responsiva</h3>
                <p>Funciona perfeitamente no celular</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üîä</div>
                <h3>Text-to-Speech</h3>
                <p>Resposta por voz (em desenvolvimento)</p>
            </div>
        </div>

        <!-- Testing Guide -->
        <div class="step-card">
            <div class="step-title">
                <span class="step-number">6</span>
                <span>Testar a Interface</span>
            </div>
            
            <h4>No Computador:</h4>
            <a href="http://localhost:8001" target="_blank" class="btn">üñ•Ô∏è Abrir Interface</a>
            <a href="http://localhost:8001/docs" target="_blank" class="btn btn-secondary">üìñ API Docs</a>
            
            <h4>Testes a Realizar:</h4>
            <ul>
                <li>üé§ <strong>Grava√ß√£o de Voz:</strong> Clique no microfone e permita acesso</li>
                <li>üí¨ <strong>Chat de Texto:</strong> Digite mensagens na caixa</li>
                <li>üîå <strong>WebSocket:</strong> Verifique status "Conectado"</li>
                <li>üì± <strong>Celular:</strong> Acesse via QR code na mesma WiFi</li>
            </ul>
        </div>

        <!-- Troubleshooting -->
        <div class="troubleshoot">
            <h3>üîß Solu√ß√£o de Problemas</h3>
            
            <h4>‚ùå Erro: "Modelo Whisper n√£o carregando"</h4>
            <ul>
                <li>Aguarde o download (primeira execu√ß√£o)</li>
                <li>Verifique espa√ßo em disco (modelo ~150MB)</li>
                <li>Reinstale: <code>pip install --upgrade openai-whisper</code></li>
            </ul>

            <h4>‚ùå Erro: "Connection Refused"</h4>
            <ul>
                <li>Verifique se o servidor est√° rodando</li>
                <li>Confirme a porta 8001</li>
                <li>Desative firewall/antiv√≠rus temporariamente</li>
            </ul>

            <h4>‚ùå Erro: "Microfone n√£o funciona"</h4>
            <ul>
                <li>Permita acesso ao microfone no navegador</li>
                <li>Use HTTPS em produ√ß√£o</li>
                <li>Teste em navegador diferente</li>
            </ul>

            <h4>üîç Verificar Logs:</h4>
            <div class="code-block">
# Terminal onde o servidor est√° rodando mostra logs em tempo real
# Procure por: "‚úÖ Whisper model loaded successfully"
            </div>
        </div>

        <!-- WhatsApp Integration -->
        <div class="step-card">
            <div class="step-title">
                <span class="step-number">7</span>
                <span>Integra√ß√£o WhatsApp (Opcional)</span>
            </div>
            
            <div class="network-info">
                <h4>üì± WhatsApp Business API</h4>
                <p>Para integra√ß√£o completa com WhatsApp:</p>
                <ol>
                    <li>Configure WhatsApp Business API</li>
                    <li>Defina webhook: <code>http://SEU_IP:8001/api/whatsapp/webhook</code></li>
                    <li>Teste com: <code>python test_whatsapp.py</code></li>
                </ol>
            </div>
        </div>

        <!-- Progress Tracking -->
        <div class="step-card">
            <div class="step-title">
                <span class="step-number">üìä</span>
                <span>Status do Sistema</span>
            </div>
            
            <div>
                <label>Backend FastAPI:</label>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
            </div>
            
            <div>
                <label>Whisper STT:</label>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
            </div>
            
            <div>
                <label>Interface Web:</label>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
            </div>
            
            <div>
                <label>WhatsApp Integration:</label>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%;"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <h3>üéØ Sistema Pronto!</h3>
            <p>WhatsApp Voice Agent V2 - Desenvolvido com FastAPI + Whisper</p>
            <p>üìß Suporte: Verifique logs do terminal | üîó Docs: /docs | üíö Health: /health</p>
        </div>
    </div>

    <script>
        // Copy code functionality
        function copyCode(button) {
            const codeBlock = button.nextElementSibling || button.parentElement;
            const text = codeBlock.textContent.replace('Copiar', '').trim();
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copiado!';
                setTimeout(() => {
                    button.textContent = 'Copiar';
                }, 2000);
            });
        }

        // Detect local IP
        function detectIP() {
            // This is a simple method, in a real scenario you might need server-side help
            const ipInput = document.getElementById('ipInput');
            
            // Try to get IP from WebRTC (works in most browsers)
            const RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
            
            if (RTCPeerConnection) {
                const pc = new RTCPeerConnection({iceServers: [{urls: 'stun:stun.l.google.com:19302'}]});
                pc.createDataChannel('');
                pc.createOffer().then(pc.setLocalDescription.bind(pc));
                
                pc.onicecandidate = function(event) {
                    if (event.candidate) {
                        const candidate = event.candidate.candidate;
                        const ip = candidate.match(/(\d+\.\d+\.\d+\.\d+)/);
                        if (ip && ip[1] !== '127.0.0.1') {
                            ipInput.value = ip[1];
                            document.getElementById('currentIP').textContent = `üåê IP Detectado: ${ip[1]}`;
                            pc.close();
                        }
                    }
                };
            } else {
                alert('Detec√ß√£o autom√°tica n√£o suportada. Digite o IP manualmente.');
            }
        }

        // Generate QR Code
        function generateQR() {
            const ip = document.getElementById('ipInput').value;
            if (!ip || !ip.match(/^\d+\.\d+\.\d+\.\d+$/)) {
                alert('Por favor, digite um IP v√°lido (ex: 192.168.1.100)');
                return;
            }

            const url = `http://${ip}:8001`;
            
            // Clear previous QR code
            document.getElementById('qrcode').innerHTML = '';
            
            // Generate QR code using qrcode.js
            const qr = qrcode(0, 'M');
            qr.addData(url);
            qr.make();
            
            // Create QR code image
            const qrImage = document.createElement('img');
            qrImage.src = qr.createDataURL(8, 4);
            qrImage.style.maxWidth = '200px';
            qrImage.style.border = '2px solid #4CAF50';
            qrImage.style.borderRadius = '10px';
            
            document.getElementById('qrcode').appendChild(qrImage);
            document.getElementById('qrcode').style.display = 'block';
            
            // Update links
            document.getElementById('mainLink').textContent = url;
            document.getElementById('healthLink').textContent = `${url}/health`;
            document.getElementById('mobileLinks').style.display = 'block';
            
            // Show success message
            const currentIP = document.getElementById('currentIP');
            currentIP.innerHTML = `
                <div style="color: #28a745; font-size: 1.1em;">
                    ‚úÖ QR Code gerado para: <strong>${url}</strong><br>
                    üì± Escaneie com o celular na mesma WiFi
                </div>
            `;
        }

        // Auto-detect IP on page load
        window.onload = function() {
            detectIP();
        };
    </script>
</body>
</html>